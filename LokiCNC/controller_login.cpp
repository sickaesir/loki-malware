#include "controller_login.h"
#include <windows.h>
#include <fstream>
#include <vector>
#include <string>
#include <sstream>

struct login
{
	char username[20];
	char password[20];
};
std::vector<login> logins;
CRITICAL_SECTION crit_sec;

void load_logins()
{
	InitializeCriticalSection(&crit_sec);
	std::ifstream read_file;
	read_file.open(".\\logins.cfg");

	std::string line = "";
	while (std::getline(read_file, line))
	{
		login tmp;
		std::stringstream iss(line);
		iss >> tmp.username >> tmp.password;
		logins.push_back(tmp);
	}
}

bool try_login(char* username, char* password)
{
	EnterCriticalSection(&crit_sec);
	bool found = false;
	for (auto& entry : logins)
	{
		if (stricmp(username, entry.username) == 0 && strcmp(password, entry.password) == 0)
		{
			found = true;
			break;
		}
	}

	LeaveCriticalSection(&crit_sec);
	return found;
}
