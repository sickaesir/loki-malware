#include "common.h"
#include "encoder.h"
#include <ctype.h>
#include <limits.h>

#define LFSR_POLY 0xCC00000000000000ull /* maximum length lfsr for 64 bits */



#pragma warning(push)
#pragma warning(disable : 4146)
void xor_encode(unsigned char *buf, size_t size, unsigned long long key)
{
	unsigned long long int seed = key;
	unsigned long long int poly = LFSR_POLY;

	int i;

	for (; size--; ++buf) {
		for (i = 0; i != CHAR_BIT; ++i) {
			*buf ^= (seed & 1u) << i;
			seed = (seed >> 1u) ^ (-(seed & 1u) & poly);
		}
	}
}
#pragma warning(pop) 
